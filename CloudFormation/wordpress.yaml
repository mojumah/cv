Parameters: 
  myKeyPair: 
    Description: Amazon EC2 Key Pair
    Type: "AWS::EC2::KeyPair::KeyName"
  NetworkStackNameParameter:
    Type: String
    Default: "wordpress-vpc"

Resources:

  Ec2Instance:
    Type: 'AWS::EC2::Instance'
    Properties:
      InstanceType: t2.small
      ImageId: ami-07caf09b362be10b8
      KeyName: !Ref myKeyPair
      AvailabilityZone: "us-east-1a" 
      SecurityGroupIds:
        - Fn::ImportValue: !Sub "${NetworkStackNameParameter}-SecurityGroupID"
      SubnetId: 
        Fn::ImportValue: !Sub "${NetworkStackNameParameter}-SubnetID"
      UserData:
        Fn::Base64:
          !Sub |
             #!/bin/bash
             yum update -y
             dnf install wget php-mysqlnd httpd php-fpm php-mysqli mariadb105-server php-json php php-devel -y
             wget https://wordpress.org/latest.tar.gz
             tar -xzf latest.tar.gz
             sudo systemctl start mariadb httpd
             cp wordpress/wp-config-sample.php wordpress/wp-config.php

  ElasticIP:
    Type: 'AWS::EC2::EIP' 
    Properties:
      Domain: VPC
      InstanceId: !Ref Ec2Instance  
      
